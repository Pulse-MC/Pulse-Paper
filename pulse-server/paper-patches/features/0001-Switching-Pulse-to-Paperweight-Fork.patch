From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: tizis0 <hexgames84@gmail.com>
Date: Fri, 6 Feb 2026 23:16:00 +0600
Subject: [PATCH] Switching Pulse to Paperweight Fork


diff --git a/src/main/java/com/destroystokyo/paper/Metrics.java b/src/main/java/com/destroystokyo/paper/Metrics.java
index 9f4d73fd321f6f0cd19fdd1b63068d2ea6c0816b..421f72984a03368c1c3774533e74b7c4dd18e698 100644
--- a/src/main/java/com/destroystokyo/paper/Metrics.java
+++ b/src/main/java/com/destroystokyo/paper/Metrics.java
@@ -1,6 +1,7 @@
 package com.destroystokyo.paper;
 
 import net.minecraft.server.MinecraftServer;
+import net.minecraft.server.dedicated.DedicatedServer;
 import org.bukkit.Bukkit;
 import org.bukkit.configuration.file.YamlConfiguration;
 import org.bukkit.craftbukkit.util.CraftMagicNumbers;
@@ -26,6 +27,7 @@ import java.util.logging.Logger;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 import java.util.zip.GZIPOutputStream;
+// PULSE_MODIFIED
 
 /**
  * bStats collects some data for plugin authors.
@@ -578,10 +580,10 @@ public class Metrics {
 
                 // Inform the server owners about bStats
                 config.options().header(
-                        "bStats collects some data for plugin authors like how many servers are using their plugins.\n" +
-                                "To honor their work, you should not disable it.\n" +
-                                "This has nearly no effect on the server performance!\n" +
-                                "Check out https://bStats.org/ to learn more :)"
+                    "bStats collects some data for plugin authors like how many servers are using their plugins.\n" +
+                        "To honor their work, you should not disable it.\n" +
+                        "This has nearly no effect on the server performance!\n" +
+                        "Check out https://bStats.org/ to learn more :)"
                 ).copyDefaults(true);
                 try {
                     config.save(configFile);
@@ -593,89 +595,16 @@ public class Metrics {
             boolean logFailedRequests = config.getBoolean("logFailedRequests", false);
             // Only start Metrics, if it's enabled in the config
             if (config.getBoolean("enabled", true)) {
-                Metrics metrics = new Metrics("Paper", serverUUID, logFailedRequests, Bukkit.getLogger());
+                Metrics metrics = new Metrics("Pulse", serverUUID, logFailedRequests, Bukkit.getLogger());
 
-                metrics.addCustomChart(new Metrics.SimplePie("minecraft_version", () -> {
-                    String minecraftVersion = Bukkit.getVersion();
-                    minecraftVersion = minecraftVersion.substring(minecraftVersion.indexOf("MC: ") + 4, minecraftVersion.length() - 1);
-                    return minecraftVersion;
-                }));
+                metrics.addCustomChart(new Metrics.SimplePie("minecraft_version", Bukkit::getMinecraftVersion));
 
                 metrics.addCustomChart(new Metrics.SingleLineChart("players", () -> Bukkit.getOnlinePlayers().size()));
-                metrics.addCustomChart(new Metrics.SimplePie("online_mode", () -> Bukkit.getOnlineMode() ? "online" : "offline"));
-                final String paperVersion;
-                final String implVersion = org.bukkit.craftbukkit.Main.class.getPackage().getImplementationVersion();
-                if (implVersion != null) {
-                    final String buildOrHash = implVersion.substring(implVersion.lastIndexOf('-') + 1);
-                    paperVersion = "git-Paper-%s-%s".formatted(Bukkit.getServer().getMinecraftVersion(), buildOrHash);
-                } else {
-                    paperVersion = "unknown";
-                }
-                metrics.addCustomChart(new Metrics.SimplePie("paper_version", () -> paperVersion));
-
-                metrics.addCustomChart(new Metrics.DrilldownPie("java_version", () -> {
-                    Map<String, Map<String, Integer>> map = new HashMap<>();
-                    String javaVersion = System.getProperty("java.version");
-                    Map<String, Integer> entry = new HashMap<>();
-                    entry.put(javaVersion, 1);
-
-                    // http://openjdk.java.net/jeps/223
-                    // Java decided to change their versioning scheme and in doing so modified the java.version system
-                    // property to return $major[.$minor][.$security][-ea], as opposed to 1.$major.0_$identifier
-                    // we can handle pre-9 by checking if the "major" is equal to "1", otherwise, 9+
-                    String majorVersion = javaVersion.split("\\.")[0];
-                    String release;
-
-                    int indexOf = javaVersion.lastIndexOf('.');
-
-                    if (majorVersion.equals("1")) {
-                        release = "Java " + javaVersion.substring(0, indexOf);
-                    } else {
-                        // of course, it really wouldn't be all that simple if they didn't add a quirk, now would it
-                        // valid strings for the major may potentially include values such as -ea to deannotate a pre release
-                        Matcher versionMatcher = Pattern.compile("\\d+").matcher(majorVersion);
-                        if (versionMatcher.find()) {
-                            majorVersion = versionMatcher.group(0);
-                        }
-                        release = "Java " + majorVersion;
-                    }
-                    map.put(release, entry);
-
-                    return map;
-                }));
-
-                metrics.addCustomChart(new Metrics.DrilldownPie("legacy_plugins", () -> {
-                    Map<String, Map<String, Integer>> map = new HashMap<>();
-
-                    // count legacy plugins
-                    int legacy = 0;
-                    for (Plugin plugin : Bukkit.getPluginManager().getPlugins()) {
-                        if (CraftMagicNumbers.isLegacy(plugin.getDescription())) {
-                            legacy++;
-                        }
-                    }
-
-                    // insert real value as lower dimension
-                    Map<String, Integer> entry = new HashMap<>();
-                    entry.put(String.valueOf(legacy), 1);
-
-                    // create buckets as higher dimension
-                    if (legacy == 0) {
-                        map.put("0 \uD83D\uDE0E", entry); // :sunglasses:
-                    } else if (legacy <= 5) {
-                        map.put("1-5", entry);
-                    } else if (legacy <= 10) {
-                        map.put("6-10", entry);
-                    } else if (legacy <= 25) {
-                        map.put("11-25", entry);
-                    } else if (legacy <= 50) {
-                        map.put("26-50", entry);
-                    } else {
-                        map.put("50+ \uD83D\uDE2D", entry); // :cry:
-                    }
-
-                    return map;
-                }));
+
+                metrics.addCustomChart(new Metrics.SingleLineChart("saved_packets", dev.pulsemc.pulse.metrics.Metrics::getAndResetSavedPackets));
+                final String paperVersion = DedicatedServer.getServer().name();
+
+                metrics.addCustomChart(new Metrics.SimplePie("version", () -> paperVersion));
             }
 
         }
diff --git a/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java b/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
index 602d3ce2cd16405f35453ce12a207b70312a4a8a..a15fc9538820c2cd0fa9eb2388de4783c01bf69e 100644
--- a/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
+++ b/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
@@ -15,35 +15,39 @@ import java.net.HttpURLConnection;
 import java.net.URI;
 import java.net.URL;
 import java.nio.charset.StandardCharsets;
-import java.util.Optional;
 import java.util.OptionalInt;
-import java.util.stream.StreamSupport;
 import net.kyori.adventure.text.Component;
-import net.kyori.adventure.text.logger.slf4j.ComponentLogger;
 import net.kyori.adventure.text.event.ClickEvent;
 import net.kyori.adventure.text.format.NamedTextColor;
 import net.kyori.adventure.text.format.TextDecoration;
+import net.kyori.adventure.text.logger.slf4j.ComponentLogger;
 import org.checkerframework.checker.nullness.qual.NonNull;
 import org.checkerframework.checker.nullness.qual.Nullable;
 import org.checkerframework.framework.qual.DefaultQualifier;
 import org.apache.logging.log4j.LogManager;
 import org.slf4j.Logger;
-import java.util.List;
 
 import static net.kyori.adventure.text.Component.text;
 import static net.kyori.adventure.text.format.TextColor.color;
 import static io.papermc.paper.ServerBuildInfo.StringRepresentation.VERSION_SIMPLE;
+// PULSE_MODIFIED
 
 @DefaultQualifier(NonNull.class)
 public class PaperVersionFetcher implements VersionFetcher {
     private static final Logger LOGGER = LogUtils.getClassLogger();
     private static final ComponentLogger COMPONENT_LOGGER = ComponentLogger.logger(LogManager.getRootLogger().getName());
+
     private static final int DISTANCE_ERROR = -1;
     private static final int DISTANCE_UNKNOWN = -2;
-    private static final String DOWNLOAD_PAGE = "https://papermc.io/downloads/paper";
-    private static final String REPOSITORY = "PaperMC/Paper";
+    // Pulse start - Custom version message
+
+    // Pulse API Endpoints
+    private static final String API_DEV_BUILDS = "https://api.pulsemc.dev/devbuilds";
+    private static final String API_RELEASES = "https://api.pulsemc.dev/releases";
+    private static final String DOWNLOAD_PAGE = "https://pulsemc.dev/";
+    // Pulse end - Custom version message
     private static final ServerBuildInfo BUILD_INFO = ServerBuildInfo.buildInfo();
-    private static final String USER_AGENT = BUILD_INFO.brandName() + "/" + BUILD_INFO.asString(VERSION_SIMPLE) + " (https://papermc.io)";
+    private static final String USER_AGENT = BUILD_INFO.brandName() + "/" + BUILD_INFO.asString(VERSION_SIMPLE) + " (Pulse Version Checker)"; // Pulse - Custom version message
     private static final Gson GSON = new Gson();
 
     @Override
@@ -54,8 +58,8 @@ public class PaperVersionFetcher implements VersionFetcher {
     @Override
     public Component getVersionMessage() {
         final Component updateMessage;
-        if (BUILD_INFO.buildNumber().isEmpty() && BUILD_INFO.gitCommit().isEmpty()) {
-            updateMessage = text("You are running a development version without access to version information", color(0xFF5300));
+        if (BUILD_INFO.buildNumber().isEmpty()) {
+            updateMessage = text("You are running a custom version without access to version information", color(0xFF5300));
         } else {
             updateMessage = getUpdateStatusMessage();
         }
@@ -64,185 +68,194 @@ public class PaperVersionFetcher implements VersionFetcher {
         return history != null ? Component.textOfChildren(updateMessage, Component.newline(), history) : updateMessage;
     }
 
+    // Pulse start - Custom version message
+
+    private enum BuildType {
+        STABLE,
+        DEV,
+        UNKNOWN
+    }
+
+    private record PulseVersionResult(BuildType type, int distance, int currentBuild, int latestBuild) {}
+
     public static void getUpdateStatusStartupMessage() {
-        int distance = DISTANCE_ERROR;
+        PulseVersionResult result = fetchPulseVersion();
 
-        final OptionalInt buildNumber = BUILD_INFO.buildNumber();
-        if (buildNumber.isEmpty() && BUILD_INFO.gitCommit().isEmpty()) {
-            COMPONENT_LOGGER.warn(text("*** You are running a development version without access to version information ***"));
-        } else {
-            final Optional<MinecraftVersionFetcher> apiResult = fetchMinecraftVersionList();
-            if (buildNumber.isPresent()) {
-                distance = fetchDistanceFromSiteApi(buildNumber.getAsInt());
-            } else {
-                final Optional<String> gitBranch = BUILD_INFO.gitBranch();
-                final Optional<String> gitCommit = BUILD_INFO.gitCommit();
-                if (gitBranch.isPresent() && gitCommit.isPresent()) {
-                    distance = fetchDistanceFromGitHub(gitBranch.get(), gitCommit.get());
-                }
-            }
+        if (result.type == BuildType.DEV) {
+            COMPONENT_LOGGER.warn(text("************************************************************", NamedTextColor.RED));
+            COMPONENT_LOGGER.warn(text("* WARNING: YOU ARE RUNNING A DEVELOPMENT BUILD OF PULSE!   *", NamedTextColor.RED));
+            COMPONENT_LOGGER.warn(text("* Build ID: " + result.currentBuild, NamedTextColor.RED));
+            COMPONENT_LOGGER.warn(text("* This version may contain bugs or unstable features.      *", NamedTextColor.RED));
+            COMPONENT_LOGGER.warn(text("************************************************************", NamedTextColor.RED));
+        }
 
-            switch (distance) {
-                case DISTANCE_ERROR -> COMPONENT_LOGGER.error(text("*** Error obtaining version information! Cannot fetch version info ***"));
-                case 0 -> apiResult.ifPresent(result -> {
-                    COMPONENT_LOGGER.warn(text("*************************************************************************************"));
-                    COMPONENT_LOGGER.warn(text("You are running the latest build for your Minecraft version (" + BUILD_INFO.minecraftVersionId() + ")"));
-                    COMPONENT_LOGGER.warn(text("However, you are " + result.distance() + " release(s) behind the latest stable release (" + result.latestVersion() + ")!"));
-                    COMPONENT_LOGGER.warn(text("It is recommended that you update as soon as possible"));
-                    COMPONENT_LOGGER.warn(text(DOWNLOAD_PAGE));
-                    COMPONENT_LOGGER.warn(text("*************************************************************************************"));
-                });
-                case DISTANCE_UNKNOWN -> COMPONENT_LOGGER.warn(text("*** You are running an unknown version! Cannot fetch version info ***"));
-                default -> {
-                    if (apiResult.isPresent()) {
-                        COMPONENT_LOGGER.warn(text("*** You are running an outdated version of Minecraft, which is " + apiResult.get().distance() + " release(s) and " + distance + " build(s) behind!"));
-                        COMPONENT_LOGGER.warn(text("*** Please update to the latest stable version on " + DOWNLOAD_PAGE + " ***"));
-                    } else {
-                        COMPONENT_LOGGER.info(text("*** Currently you are " + distance + " build(s) behind ***"));
-                        COMPONENT_LOGGER.info(text("*** It is highly recommended to download the latest build from " + DOWNLOAD_PAGE + " ***"));
-                    }
-                }
+        switch (result.distance) {
+            case DISTANCE_ERROR -> COMPONENT_LOGGER.warn(text("Error obtaining version information from Pulse API."));
+            case 0 -> COMPONENT_LOGGER.info(text("You are running the latest version of Pulse (" + result.type + ")."));
+            case DISTANCE_UNKNOWN -> COMPONENT_LOGGER.warn(text("Unknown version! Cannot verify build ID against the API."));
+            default -> {
+                COMPONENT_LOGGER.warn(text("************************************************************"));
+                COMPONENT_LOGGER.warn(text("* You are running an outdated version of Pulse (" + result.type + ")!"));
+                COMPONENT_LOGGER.warn(text("* You are " + result.distance + " build(s) behind."));
+                COMPONENT_LOGGER.warn(text("* Latest build for your version: " + result.latestBuild));
+                COMPONENT_LOGGER.warn(text("* Download the latest build:"));
+                COMPONENT_LOGGER.warn(text("* " + DOWNLOAD_PAGE));
+                COMPONENT_LOGGER.warn(text("************************************************************"));
             }
         }
     }
 
     private static Component getUpdateStatusMessage() {
-        int distance = DISTANCE_ERROR;
+        PulseVersionResult result = fetchPulseVersion();
 
-        final OptionalInt buildNumber = PaperVersionFetcher.BUILD_INFO.buildNumber();
-        if (buildNumber.isPresent()) {
-            distance = fetchDistanceFromSiteApi(buildNumber.getAsInt());
+        Component baseMessage;
+        if (result.type == BuildType.DEV) {
+            baseMessage = text("You are running a Pulse(Paper) DEVELOPMENT build (#" + result.currentBuild + ")", NamedTextColor.RED);
         } else {
-            final Optional<String> gitBranch = PaperVersionFetcher.BUILD_INFO.gitBranch();
-            final Optional<String> gitCommit = PaperVersionFetcher.BUILD_INFO.gitCommit();
-            if (gitBranch.isPresent() && gitCommit.isPresent()) {
-                distance = fetchDistanceFromGitHub(gitBranch.get(), gitCommit.get());
-            }
+            baseMessage = text("You are running a Pulse(Paper) Stable build", NamedTextColor.GREEN);
         }
 
-        return switch (distance) {
+        return switch (result.distance) {
             case DISTANCE_ERROR -> text("Error obtaining version information", NamedTextColor.YELLOW);
-            case 0 -> text("You are running the latest version", NamedTextColor.GREEN);
+            case 0 -> baseMessage.append(text(" (Latest)", NamedTextColor.GREEN));
             case DISTANCE_UNKNOWN -> text("Unknown version", NamedTextColor.YELLOW);
-            default -> text("You are " + distance + " version(s) behind", NamedTextColor.YELLOW)
+            default -> baseMessage
+                .append(Component.newline())
+                .append(text("You are " + result.distance + " version(s) behind", NamedTextColor.YELLOW))
                 .append(Component.newline())
-                .append(text("Download the new version at: ")
+                .append(text("Download update: ")
                     .append(text(DOWNLOAD_PAGE, NamedTextColor.GOLD)
                         .hoverEvent(text("Click to open", NamedTextColor.WHITE))
                         .clickEvent(ClickEvent.openUrl(DOWNLOAD_PAGE))));
         };
     }
 
-    private record MinecraftVersionFetcher(String latestVersion, int distance) {}
+    private static PulseVersionResult fetchPulseVersion() {
+        OptionalInt buildNumberOpt = BUILD_INFO.buildNumber();
+        if (buildNumberOpt.isEmpty()) {
+            return new PulseVersionResult(BuildType.UNKNOWN, DISTANCE_UNKNOWN, -1, -1);
+        }
+
+        int currentBuildId = buildNumberOpt.getAsInt();
+        String currentMcVersion = BUILD_INFO.minecraftVersionId();
+
+        boolean isDev = false;
+        boolean isRelease = false;
+
+        int maxDevForThisVersion = -1;
+        int maxReleaseForThisVersion = -1;
+
+        // Fetch Dev Builds
+        try {
+            JsonArray devJson = fetchJsonArray(API_DEV_BUILDS);
+            if (devJson != null) {
+                for (JsonElement el : devJson) {
+                    int id = extractId(el);
+                    String version = extractMcVersion(el);
+
+                    if (id == currentBuildId) {
+                        isDev = true;
+                    }
 
-    private static Optional<MinecraftVersionFetcher> fetchMinecraftVersionList() {
-        final String currentVersion = PaperVersionFetcher.BUILD_INFO.minecraftVersionId();
+                    if (version != null && version.equals(currentMcVersion)) {
+                        if (id > maxDevForThisVersion) maxDevForThisVersion = id;
+                    }
+                }
+            }
+        } catch (Exception e) {
+            LOGGER.error("Failed to fetch dev builds from Pulse API", e);
+            return new PulseVersionResult(BuildType.UNKNOWN, DISTANCE_ERROR, currentBuildId, -1);
+        }
 
+        // Fetch Releases
         try {
-            final URL versionsUrl = URI.create("https://fill.papermc.io/v3/projects/paper").toURL();
-            final HttpURLConnection connection = (HttpURLConnection) versionsUrl.openConnection();
-            connection.setConnectTimeout(5000);
-            connection.setReadTimeout(5000);
-            connection.setRequestProperty("User-Agent", PaperVersionFetcher.USER_AGENT);
-            connection.setRequestProperty("Accept", "application/json");
-
-            try (final BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8))) {
-                final JsonObject json = GSON.fromJson(reader, JsonObject.class);
-                final JsonObject versions = json.getAsJsonObject("versions");
-                final List<String> versionList = versions.keySet().stream()
-                    .map(versions::getAsJsonArray)
-                    .flatMap(array -> StreamSupport.stream(array.spliterator(), false))
-                    .map(JsonElement::getAsString)
-                    .toList();
-
-                for (final String latestVersion : versionList) {
-                    if (latestVersion.equals(currentVersion)) {
-                        return Optional.empty();
+            JsonArray releaseJson = fetchJsonArray(API_RELEASES);
+            if (releaseJson != null) {
+                for (JsonElement el : releaseJson) {
+                    int id = extractId(el);
+                    String version = extractMcVersion(el);
+
+                    if (id == currentBuildId) {
+                        isRelease = true;
                     }
 
-                    try {
-                        final URL buildsUrl = URI.create("https://fill.papermc.io/v3/projects/paper/versions/" + latestVersion + "/builds/latest").toURL();
-                        final HttpURLConnection connection2 = (HttpURLConnection) buildsUrl.openConnection();
-                        connection2.setConnectTimeout(5000);
-                        connection2.setReadTimeout(5000);
-                        connection2.setRequestProperty("User-Agent", PaperVersionFetcher.USER_AGENT);
-                        connection2.setRequestProperty("Accept", "application/json");
-
-                        try (final BufferedReader buildReader = new BufferedReader(new InputStreamReader(connection2.getInputStream(), StandardCharsets.UTF_8))) {
-                            final JsonObject buildJson = GSON.fromJson(buildReader, JsonObject.class);
-                            if ("STABLE".equals(buildJson.get("channel").getAsString())) {
-                                final int currentIndex = versionList.indexOf(currentVersion);
-                                final int latestIndex = versionList.indexOf(latestVersion);
-                                final int distance = currentIndex - latestIndex;
-                                return Optional.of(new MinecraftVersionFetcher(latestVersion, distance));
-                            }
-                        } catch (final JsonSyntaxException ex) {
-                            LOGGER.error("Error parsing json from Paper's downloads API", ex);
-                        }
-                    } catch (final IOException e) {
-                        LOGGER.error("Error while parsing latest build", e);
+                    if (version != null && version.equals(currentMcVersion)) {
+                        if (id > maxReleaseForThisVersion) maxReleaseForThisVersion = id;
                     }
                 }
-            } catch (final JsonSyntaxException ex) {
-                LOGGER.error("Error parsing json from Paper's downloads API", ex);
             }
-        } catch (final IOException e) {
-            LOGGER.error("Error while parsing version list", e);
+        } catch (Exception e) {
+            LOGGER.debug("Failed to fetch releases from Pulse API", e);
+        }
+
+        if (isRelease) {
+            int distance = (maxReleaseForThisVersion > 0) ? (maxReleaseForThisVersion - currentBuildId) : 0;
+            if (distance < 0) distance = 0;
+            return new PulseVersionResult(BuildType.STABLE, distance, currentBuildId, maxReleaseForThisVersion);
         }
-        return Optional.empty();
+        else if (isDev) {
+            int distance = (maxDevForThisVersion > 0) ? (maxDevForThisVersion - currentBuildId) : 0;
+            if (distance < 0) distance = 0;
+            return new PulseVersionResult(BuildType.DEV, distance, currentBuildId, maxDevForThisVersion);
+        }
+
+        return new PulseVersionResult(BuildType.UNKNOWN, DISTANCE_UNKNOWN, currentBuildId, -1);
     }
 
-    private static int fetchDistanceFromSiteApi(final int jenkinsBuild) {
+    private static int extractId(JsonElement el) {
         try {
-            final URL buildsUrl = URI.create("https://fill.papermc.io/v3/projects/paper/versions/" + PaperVersionFetcher.BUILD_INFO.minecraftVersionId() + "/builds").toURL();
-            final HttpURLConnection connection = (HttpURLConnection) buildsUrl.openConnection();
-            connection.setConnectTimeout(5000);
-            connection.setReadTimeout(5000);
-            connection.setRequestProperty("User-Agent", PaperVersionFetcher.USER_AGENT);
-            connection.setRequestProperty("Accept", "application/json");
-            try (final BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8))) {
-                final JsonArray builds = GSON.fromJson(reader, JsonArray.class);
-                final int latest = StreamSupport.stream(builds.spliterator(), false)
-                    .mapToInt(build -> build.getAsJsonObject().get("id").getAsInt())
-                    .max()
-                    .orElseThrow();
-                return Math.max(latest - jenkinsBuild, 0);
-            } catch (final JsonSyntaxException ex) {
-                LOGGER.error("Error parsing json from Paper's downloads API", ex);
-                return DISTANCE_ERROR;
+            if (el.isJsonObject()) {
+                JsonObject obj = el.getAsJsonObject();
+                if (obj.has("build_id")) {
+                    return Integer.parseInt(obj.get("build_id").getAsString());
+                }
+                if (obj.has("id")) return obj.get("id").getAsInt();
+            } else if (el.isJsonPrimitive()) {
+                return el.getAsInt();
             }
-        } catch (final IOException e) {
-            LOGGER.error("Error while parsing version", e);
-            return DISTANCE_ERROR;
+        } catch (NumberFormatException ignored) {
         }
+        return -1;
     }
 
-    // Contributed by Techcable <Techcable@outlook.com> in GH-65
-    private static int fetchDistanceFromGitHub(final String branch, final String hash) {
+    private static @Nullable String extractMcVersion(JsonElement el) {
         try {
-            final HttpURLConnection connection = (HttpURLConnection) URI.create("https://api.github.com/repos/%s/compare/%s...%s".formatted(PaperVersionFetcher.REPOSITORY, branch, hash)).toURL().openConnection();
-            connection.setConnectTimeout(5000);
-            connection.setReadTimeout(5000);
-            connection.setRequestProperty("User-Agent", PaperVersionFetcher.USER_AGENT);
-            connection.connect();
-            if (connection.getResponseCode() == HttpURLConnection.HTTP_NOT_FOUND) return DISTANCE_UNKNOWN; // Unknown commit
-            try (final BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8))) {
-                final JsonObject obj = GSON.fromJson(reader, JsonObject.class);
-                final String status = obj.get("status").getAsString();
-                return switch (status) {
-                    case "identical" -> 0;
-                    case "behind" -> obj.get("behind_by").getAsInt();
-                    default -> DISTANCE_ERROR;
-                };
-            } catch (final JsonSyntaxException | NumberFormatException e) {
-                LOGGER.error("Error parsing json from GitHub's API", e);
-                return DISTANCE_ERROR;
+            if (el.isJsonObject()) {
+                JsonObject obj = el.getAsJsonObject();
+                if (obj.has("minecraft_version")) return obj.get("minecraft_version").getAsString();
+                if (obj.has("mc_version")) return obj.get("mc_version").getAsString();
+                if (obj.has("version")) return obj.get("version").getAsString();
+                if (obj.has("game_version")) return obj.get("game_version").getAsString();
             }
-        } catch (final IOException e) {
-            LOGGER.error("Error while parsing version", e);
-            return DISTANCE_ERROR;
+        } catch (Exception ignored) {
+        }
+        return null;
+    }
+
+    private static @Nullable JsonArray fetchJsonArray(String urlString) throws IOException {
+        URL url = URI.create(urlString).toURL();
+        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
+        connection.setConnectTimeout(5000);
+        connection.setReadTimeout(5000);
+        connection.setRequestProperty("User-Agent", USER_AGENT);
+        connection.setRequestProperty("Accept", "application/json");
+
+        if (connection.getResponseCode() != 200) {
+            return null;
+        }
+
+        try (BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8))) {
+            JsonObject root = GSON.fromJson(reader, JsonObject.class);
+            if (root != null && root.has("data") && root.get("data").isJsonArray()) {
+                return root.getAsJsonArray("data");
+            }
+            return null;
+        } catch (JsonSyntaxException e) {
+            LOGGER.error("Invalid JSON from " + urlString, e);
+            return null;
         }
     }
+    // Pulse end - Custom version message
 
     private @Nullable Component getHistory() {
         final VersionHistoryManager.@Nullable VersionData data = VersionHistoryManager.INSTANCE.getVersionData();
